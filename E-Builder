#!/bin/sh

PREFIX="/usr";

CFLAGS="";
CXXFLAGS="";

ERULES="$PWD/E-Rules";
ELOG="$PWD/log";
ESOURCES="$PWD/src";

EGITURL="https://git.enlightenment.org";
DEPENDENCIES=$(grep -v ^# enlightenment.dependencies | awk -v ORS=" " '{print $0}');
REPOSITORIES=$(grep -v ^# enlightenment.git.repos);

# Start Enlightenment Build!

echo
echo " >>> Enlightenment DR18 Builder <<<";
echo


# Install Dependencies

echo
echo " * ebuilder: Installing necessary dependencies ...";
echo

sudo apt-get install $DEPENDENCIES;


# Download and Install Packages from Git Repos

if [ ! -d "$ESOURCES" ]; then mkdir -p $ESOURCES; fi;
if [ ! -d "$ELOG" ]; then mkdir -p $ELOG; fi;

for gitrepo in $REPOSITORIES; do

	cd src;

	# Obtain package name
	package=$(echo $gitrepo | awk -F/ '{print $NF}' | sed 's/\.git//g');

	# Download Source from GIT
	echo
	echo " * ebuilder: Downloading $package from git repository ...";
	echo

	git clone $EGITURL/$gitrepo;

	# Build Package
	echo
	echo " * ebuilder: Building $package from git sources ...";
	echo

	cd $package;

	cp $ERULES/$package ${package}.rules;

	chmod +x ${package}.rules

	sh ${package}.rules $PREFIX | tee -a $ELOG/${package}.log

	echo
	echo " * ebuilder: Package $package installed.";
	echo
	
done;

exit 0;
